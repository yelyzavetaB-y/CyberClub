@using CyberClub.ViewModels
@model BookingViewModel

<div class="sidebarMenuScroll">



    <form method="post" asp-action="FinalizeBooking" id="pageform">


        <input type="hidden" id="SelectedSeatId" name="SelectedSeatId" />

        <ul class="sidebar-menu">
            <li class="treeview">
                <a href="#"><i class="bi bi-ui-checks-grid"></i><span class="menu-text">Choose a slot</span></a>
                <ul class="treeview-menu">
                    <li>
                        <label>Date:</label>
                        <input asp-for="SelectedDate"
                               type="date"
                               class="form-control"
                               min="@DateTime.Now.ToString("yyyy-MM-dd")"
                               value="@Model.SelectedDate.ToString("yyyy-MM-dd")" />
                    </li>
                    <li>
                        <label>Time:</label>
                        <input type="time" asp-for="SelectedTimeRaw" class="form-control auto-fetch" />
                        @*  <input asp-for="SelectedTimeRaw"
                               type="time"
                               class="form-control auto-fetch"
                               value="@Model.SelectedTimeRaw"
                               data-initial-time="@Model.SelectedTimeRaw" /> *@

                        @*    <p class="text-danger">RAW FROM MODEL: @Model.SelectedTimeRaw</p> *@


                    </li>
                    <li>
                        <label>Duration (minutes):</label>
                        <input asp-for="Duration"
                               type="number"
                               class="form-control"
                               min="60"
                               step="15"
                               value="@Model.Duration" />
                    </li>
                </ul>
            </li>

            <li class="treeview">
                <a href="#"><i class="bi bi-ui-checks-grid"></i><span class="menu-text">Choose a Zone</span></a>
                <ul class="treeview-menu">
                    <li>
                        <label>Select Zone:</label>
                        <select asp-for="SelectedZoneId" class="form-control">
                            <option value="">Please choose</option>
                            @foreach (var zone in Model.Zones)
                            {
                                <option value="@zone.ZoneID">@zone.Name</option>
                            }
                        </select>
                    </li>
                </ul>
            </li>

            @*   <li>
                <button type="submit" class="btn btn-secondary mt-3 w-100">🔄 Update Seats</button>
            </li> *@
        </ul>

        <ul class="sidebar-menu">
            <li class="treeview">
                <a href="#"><i class="bi bi-person-check"></i><span class="menu-text">Choose a Seat</span></a>
                <ul class="treeview-menu" id="seatList">
                    @if (Model.Seats != null && Model.Seats.Any())
                    {
                        foreach (var seat in Model.Seats)
                        {
                            <li>
                                <label>
                                    <input type="radio" name="SelectedSeatId" value="@seat.SeatID" />
                                    @seat.SeatNumber
                                </label>
                            </li>
                        }
                    }
                    else
                    {
                        <li><span class="text-muted">No seats available. Choose zone/date/time and update.</span></li>
                    }
                </ul>
            </li>

            <li>
                <input type="hidden" name="UserID" value="@Context.Session.GetInt32("UserID")" />
                <input type="hidden" name="SelectedDate" value="@Model.SelectedDate.ToString("yyyy-MM-dd")" />
                <input type="hidden" name="SelectedTime" value="@Model.SelectedTime.ToString(@"hh\:mm")" />
                <input type="hidden" name="Duration" value="@Model.Duration" />
                <input type="hidden" name="SelectedZoneId" value="@Model.SelectedZoneId" />

                <input type="hidden" name="SelectedSeatId" id="SelectedSeatIdHidden" />

                <button id="showConfirmModalBtn" type="submit" class="btn btn-primary mt-3 w-100">Book Now</button>

            </li>
        </ul>
    </form>
</div>

<!-- Modal -->
<div class="modal fade" id="confirmBookingModal" tabindex="-1" aria-labelledby="confirmBookingLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmBookingLabel">Confirm Booking</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p><strong>Date:</strong> <span id="modal-date"></span></p>
                <p><strong>Time:</strong> <span id="modal-time"></span></p>
                <p><strong>Duration:</strong> <span id="modal-duration"></span> mins</p>
                <p><strong>Zone:</strong> <span id="modal-zone"></span></p>
                <p><strong>Seat:</strong> <span id="modal-seat"></span></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button id="confirmBookingBtn" type="button" class="btn btn-primary">Confirm</button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        document.getElementById("showConfirmModalBtn").addEventListener("click", function () {
            const date = document.querySelector('[name="SelectedDate"]').value;
            const time = document.querySelector('[name="SelectedTimeRaw"]').value;
            const duration = document.querySelector('[name="Duration"]').value;
            const zone = document.querySelector('[name="SelectedZoneId"] option:checked').text;
            const seat = document.querySelector('[name="SelectedSeatId"]:checked')?.parentElement?.textContent?.trim();

            if (!seat) {
                alert("❗ Please choose a seat.");
                return;
            }

            // Показуємо обрані значення в модалці
            document.getElementById("modal-date").textContent = date;
            document.getElementById("modal-time").textContent = time;
            document.getElementById("modal-duration").textContent = duration;
            document.getElementById("modal-zone").textContent = zone;
            document.getElementById("modal-seat").textContent = seat;

            // Bootstrap: відкриття модалки
            var modal = new bootstrap.Modal(document.getElementById("confirmBookingModal"));
            modal.show();
        });

        // Підтвердження бронювання
        document.getElementById("confirmBookingBtn").addEventListener("click", function () {
            document.getElementById("pageform").submit();
        });
    </script>

}
